{% extends 'home.html' %}

{% block content %}
<style>
    .thrift-container {
        padding: 30px 20px;
        max-width: 1400px;
        margin: 0 auto;
    }

    .thrift-header {
        margin-bottom: 40px;
        text-align: center;
    }

    .thrift-title {
        font-weight: 800;
        font-size: 2rem;
        color: var(--text-dark);
        margin-bottom: 15px;
        background: linear-gradient(90deg, var(--neon-blue), var(--accent-purple));
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
    }

    .thrift-subtitle {
        color: var(--text-medium);
        font-size: 0.95rem;
        max-width: 600px;
        margin: 0 auto;
    }

    .thrift-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
        gap: 30px;
        margin-top: 30px;
    }

    .thrift-card {
        background: rgba(255, 255, 255, 0.9);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        padding: 25px;
        box-shadow: 0 8px 32px rgba(0, 119, 255, 0.1);
        border: 1px solid rgba(0, 119, 255, 0.1);
        transition: all 0.4s ease;
        position: relative;
        overflow: hidden;
        height: 100%;
        display: flex;
        flex-direction: column;
    }

    .thrift-card:hover {
        transform: translateY(-8px);
        box-shadow: 0 20px 40px rgba(0, 119, 255, 0.15);
        border-color: rgba(0, 119, 255, 0.2);
    }

    .thrift-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 6px;
        height: 100%;
        background: linear-gradient(to bottom, var(--neon-blue), var(--accent-purple));
    }

    .card-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 1px solid rgba(0, 119, 255, 0.1);
    }

    .thrift-name {
        font-size: 1.2rem;
        font-weight: 700;
        color: var(--text-dark);
        margin: 0;
    }

    .admin-actions {
        display: flex;
        gap: 8px;
    }

    .action-btn {
        width: 36px;
        height: 36px;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        border: 1px solid;
        background: white;
        transition: all 0.3s ease;
        font-size: 0.85rem;
    }

    .edit-btn {
        color: var(--accent-blue);
        border-color: rgba(0, 119, 255, 0.2);
    }

    .edit-btn:hover {
        background: rgba(0, 119, 255, 0.08);
        border-color: var(--accent-blue);
        transform: translateY(-2px);
    }

    .delete-btn {
        color: var(--danger-red);
        border-color: rgba(220, 53, 69, 0.2);
    }

    .delete-btn:hover {
        background: rgba(220, 53, 69, 0.08);
        border-color: var(--danger-red);
        transform: translateY(-2px);
    }

    .add-item-btn {
        background: linear-gradient(135deg, var(--neon-blue), var(--accent-purple));
        color: white;
        border: none;
        padding: 14px 30px;
        border-radius: 12px;
        font-weight: 600;
        font-size: 0.9rem;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 10px;
        box-shadow: 0 4px 15px rgba(0, 119, 255, 0.2);
        transition: all 0.3s ease;
        margin-top: 20px;
    }

    .add-item-btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 25px rgba(0, 119, 255, 0.3);
        color: white;
    }

    .interest-section {
        margin-bottom: 20px;
        flex-grow: 1;
    }

    .interest-label {
        font-size: 0.8rem;
        color: var(--text-medium);
        text-transform: uppercase;
        letter-spacing: 1px;
        font-weight: 600;
        margin-bottom: 8px;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .interest-content {
        color: var(--text-dark);
        font-size: 0.9rem;
        line-height: 1.5;
        background: rgba(0, 119, 255, 0.03);
        padding: 20px;
        border-radius: 12px;
        border-left: 4px solid var(--accent-blue);
    }

    .interest-rate {
        font-size: 1.8rem;
        font-weight: 800;
        background: linear-gradient(135deg, #0f9d58, #1e7e34);
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
        margin-bottom: 5px;
    }

    .interest-rate.gold {
        background: linear-gradient(135deg, #ff8c00, #ffaa33);
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
    }

    .interest-rate.violet {
        background: linear-gradient(135deg, var(--accent-purple), #b983ff);
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
    }

    .price-range {
        font-size: 0.95rem;
        font-weight: 600;
        color: var(--text-dark);
        margin-top: 10px;
    }

    .binding-warning {
        background: rgba(255, 193, 7, 0.1);
        border-left: 4px solid #ffc107;
        padding: 12px 15px;
        border-radius: 8px;
        margin: 15px 0;
        display: flex;
        align-items: center;
        gap: 12px;
    }

    .binding-warning i {
        color: #ffc107;
        font-size: 1.1rem;
    }

    .binding-warning span {
        font-size: 0.8rem;
        color: var(--text-medium);
        font-weight: 500;
    }

    .purchase-section {
        margin-top: auto;
    }

    .buy-now-btn {
        width: 100%;
        padding: 16px;
        background: linear-gradient(135deg, #4CAF50, #45a049);
        color: white;
        border: none;
        border-radius: 12px;
        font-size: 0.9rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(76, 175, 80, 0.2);
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
    }

    .buy-now-btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 25px rgba(76, 175, 80, 0.3);
    }

    .buy-now-btn:disabled {
        opacity: 0.7;
        cursor: not-allowed;
        transform: none;
    }

    .empty-state {
        grid-column: 1 / -1;
        text-align: center;
        padding: 60px 20px;
    }

    .empty-icon {
        font-size: 3.5rem;
        color: rgba(0, 119, 255, 0.1);
        margin-bottom: 20px;
    }

    .empty-title {
        font-size: 1.6rem;
        color: var(--text-medium);
        margin-bottom: 15px;
        font-weight: 600;
    }

    .empty-text {
        color: var(--text-medium);
        font-size: 0.9rem;
        max-width: 500px;
        margin: 0 auto 30px;
    }

    /* Modal styling */
    .modal-custom {
        background-color: rgba(0, 0, 0, 0.5);
    }

    .modal-content-custom {
        background-color: white;
        border-radius: 20px;
        border: none;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
    }

    .modal-header-custom {
        background: linear-gradient(135deg, var(--neon-blue), var(--accent-purple));
        color: white;
        border-radius: 20px 20px 0 0;
        padding: 25px;
        border: none;
    }

    .modal-title-custom {
        font-weight: 700;
        font-size: 1.1rem;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .modal-body-custom {
        padding: 25px;
    }

    .modal-footer-custom {
        border-top: 1px solid rgba(0, 119, 255, 0.1);
        padding: 20px 25px;
        border-radius: 0 0 20px 20px;
    }

    .btn-cancel {
        background: rgba(0, 119, 255, 0.08);
        color: var(--accent-blue);
        border: 1px solid rgba(0, 119, 255, 0.2);
        padding: 10px 25px;
        border-radius: 10px;
        font-weight: 600;
        font-size: 0.9rem;
        transition: all 0.3s ease;
    }

    .btn-cancel:hover {
        background: rgba(0, 119, 255, 0.15);
        border-color: var(--accent-blue);
    }

    .btn-confirm {
        background: linear-gradient(135deg, #4CAF50, #45a049);
        color: white;
        border: none;
        padding: 10px 25px;
        border-radius: 10px;
        font-weight: 600;
        font-size: 0.9rem;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(76, 175, 80, 0.2);
    }

    .btn-confirm:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(76, 175, 80, 0.3);
    }

    .btn-delete {
        background: linear-gradient(135deg, var(--danger-red), #c82333);
        color: white;
        border: none;
        padding: 10px 25px;
        border-radius: 10px;
        font-weight: 600;
        font-size: 0.9rem;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(220, 53, 69, 0.2);
    }

    .btn-delete:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(220, 53, 69, 0.3);
    }

    /* Toast styling */
    .toast-custom {
        background: white;
        border-radius: 12px;
        border: 1px solid rgba(76, 175, 80, 0.2);
        box-shadow: 0 8px 32px rgba(76, 175, 80, 0.15);
    }

    .toast-header-custom {
        background: linear-gradient(135deg, #4CAF50, #45a049);
        color: white;
        border-radius: 12px 12px 0 0;
        padding: 15px 20px;
        border: none;
    }

    .toast-header-custom strong {
        font-size: 0.95rem;
    }

    .toast-body-custom {
        padding: 20px;
        color: var(--text-dark);
        font-weight: 500;
        font-size: 0.9rem;
    }

    /* Alert messages */
    .alert-custom {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border-radius: 12px;
        border: 1px solid;
        padding: 20px;
        margin-bottom: 25px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        font-size: 0.9rem;
    }

    .alert-success-custom {
        border-color: rgba(76, 175, 80, 0.3);
        background: rgba(76, 175, 80, 0.08);
    }

    .alert-error-custom {
        border-color: rgba(220, 53, 69, 0.3);
        background: rgba(220, 53, 69, 0.08);
    }

    .alert-info-custom {
        border-color: rgba(0, 119, 255, 0.3);
        background: rgba(0, 119, 255, 0.08);
    }

    /* Animation */
    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .thrift-card {
        animation: fadeInUp 0.5s ease-out;
        animation-fill-mode: both;
    }

    .thrift-card:nth-child(1) { animation-delay: 0.1s; }
    .thrift-card:nth-child(2) { animation-delay: 0.2s; }
    .thrift-card:nth-child(3) { animation-delay: 0.3s; }

    @media (max-width: 768px) {
        .thrift-grid {
            grid-template-columns: 1fr;
            gap: 20px;
        }
        
        .thrift-title {
            font-size: 1.7rem;
        }
        
        .thrift-card {
            padding: 20px;
        }
    }

    @media (max-width: 576px) {
        .thrift-container {
            padding: 20px 15px;
        }
        
        .thrift-title {
            font-size: 1.1rem;
        }
        
        .card-header {
            flex-direction: column;
            align-items: flex-start;
            gap: 15px;
        }
        
        .admin-actions {
            align-self: flex-end;
        }
    }
</style>

{% if registration_status == "active" %}
<div class="thrift-container">
    <div class="thrift-header">
        <h1 class="thrift-title">Blengo Savings Plans</h1>
        <p class="thrift-subtitle">Choose your savings plan and earn guaranteed returns</p>
        <a href="{% url 'my-purchases' %}" style="display: block; margin-top: 15px; color: var(--accent-blue); font-weight: 600; font-size: 0.9rem;">View your purchased plans</a>
    </div>

    <!-- Display Django messages -->
    {% if messages %}
        <div class="messages-container">
            {% for message in messages %}
                <div class="alert-custom {% if message.tags == 'success' %}alert-success-custom{% elif message.tags == 'error' %}alert-error-custom{% else %}alert-info-custom{% endif %}">
                    <div style="display: flex; align-items: center; justify-content: space-between;">
                        <div style="display: flex; align-items: center; gap: 12px;">
                            {% if message.tags == 'success' %}
                                <i class="fas fa-check-circle" style="color: #4CAF50; font-size: 1.1rem;"></i>
                            {% elif message.tags == 'error' %}
                                <i class="fas fa-exclamation-circle" style="color: var(--danger-red); font-size: 1.1rem;"></i>
                            {% else %}
                                <i class="fas fa-info-circle" style="color: var(--accent-blue); font-size: 1.1rem;"></i>
                            {% endif %}
                            <span style="font-weight: 500;">{{ message }}</span>
                        </div>
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% endif %}
    
    <div class="thrift-grid">
        {% for thrift in thrifts %}
            {% if thrift.thriftname == "basic" %}
            <!-- Basic Plan Card -->
            <div class="thrift-card">
                <div class="card-header">
                    <h3 class="thrift-name">{{ thrift.thriftname|upper }} PLAN</h3>
                    {% if user.is_staff or user.username == "manager" %}
                    <div class="admin-actions">
                        <a href="{% url 'edit_thrift' thrift.id %}" class="action-btn edit-btn" title="Edit Plan">
                            <i class="fas fa-edit"></i>
                        </a>
                        <button type="button" class="action-btn delete-btn" data-bs-toggle="modal" data-bs-target="#deleteModal{{ thrift.id }}" title="Delete Plan">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                    {% endif %}
                </div>
                
                <div class="interest-section">
                    <div class="interest-label">
                        <i class="fas fa-chart-line"></i>
                        ANNUAL RETURN
                    </div>
                    <div class="interest-content">
                        <div class="interest-rate">25%</div>
                        <div class="price-range">₦25,000 - ₦50,000 monthly</div>
                        <p style="margin-top: 15px; color: var(--text-medium); font-size: 0.85rem;">
                            Save between ₦25,000 and ₦50,000 monthly for 12 months and earn 25% interest at maturity.
                        </p>
                    </div>
                </div>
                
                <div class="purchase-section">
                    <form method="POST" action="{% url 'enroll_plan' %}" class="purchase-form" data-thrift-id="{{ thrift.id }}" data-thrift-name="{{ thrift.thriftname|upper }} Plan" data-plan-type="basic" data-interest-rate="25" data-price-range="25000-50000">
                        {% csrf_token %}
                        <input type="hidden" name="thrift_id" value="{{ thrift.id }}">
                        <input type="hidden" name="plan_type" value="basic">
                        <input type="hidden" name="interest_rate" value="25">
                        <input type="hidden" name="price_range" value="25000-50000">
                        
                        <div class="binding-warning">
                            <i class="fas fa-gavel"></i>
                            <span>This is a legally binding commitment. Once confirmed, you agree to complete the 12-month savings cycle.</span>
                        </div>
                        <button type="button" class="buy-now-btn">
                            <i class="fas fa-shopping-cart"></i>
                            Purchase Thrift
                        </button>
                    </form>
                </div>
            </div>

            {% elif thrift.thriftname == "plus" %}
            <!-- Plus Plan Card -->
            <div class="thrift-card">
                <div class="card-header">
                    <h3 class="thrift-name">{{ thrift.thriftname|upper }} PLAN</h3>
                    {% if user.is_staff or user.username == "manager" %}
                    <div class="admin-actions">
                        <a href="{% url 'edit_thrift' thrift.id %}" class="action-btn edit-btn" title="Edit Plan">
                            <i class="fas fa-edit"></i>
                        </a>
                        <button type="button" class="action-btn delete-btn" data-bs-toggle="modal" data-bs-target="#deleteModal{{ thrift.id }}" title="Delete Plan">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                    {% endif %}
                </div>
                
                <div class="interest-section">
                    <div class="interest-label">
                        <i class="fas fa-chart-line"></i>
                        ANNUAL RETURN
                    </div>
                    <div class="interest-content">
                        <div class="interest-rate gold">30%</div>
                        <div class="price-range">₦100,000+ monthly</div>
                        <p style="margin-top: 15px; color: var(--text-medium); font-size: 0.85rem;">
                            Save ₦100,000 or more monthly for 12 months and earn 30% interest at maturity.
                        </p>
                    </div>
                </div>
                
                <div class="purchase-section">
                    <form method="POST" action="{% url 'enroll_plan' %}" class="purchase-form" data-thrift-id="{{ thrift.id }}" data-thrift-name="{{ thrift.thriftname|upper }} Plan" data-plan-type="plus" data-interest-rate="30" data-price-range="100000+">
                        {% csrf_token %}
                        <input type="hidden" name="thrift_id" value="{{ thrift.id }}">
                        <input type="hidden" name="plan_type" value="plus">
                        <input type="hidden" name="interest_rate" value="30">
                        <input type="hidden" name="price_range" value="100000+">
                        
                        <div class="binding-warning">
                            <i class="fas fa-gavel"></i>
                            <span>This is a legally binding commitment. Once confirmed, you agree to complete the 12-month savings cycle.</span>
                        </div>
                        <button type="button" class="buy-now-btn">
                            <i class="fas fa-shopping-cart"></i>
                            Purchase Thrift
                        </button>
                    </form>
                </div>
            </div>

            {% elif thrift.thriftname == "max" %}
            <!-- Max Plan (One-time Investment) -->
            <div class="thrift-card">
                <div class="card-header">
                    <h3 class="thrift-name">{{ thrift.thriftname|upper }} PLAN</h3>
                    {% if user.is_staff or user.username == "manager" %}
                    <div class="admin-actions">
                        <a href="{% url 'edit_thrift' thrift.id %}" class="action-btn edit-btn" title="Edit Plan">
                            <i class="fas fa-edit"></i>
                        </a>
                        <button type="button" class="action-btn delete-btn" data-bs-toggle="modal" data-bs-target="#deleteModal{{ thrift.id }}" title="Delete Plan">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                    {% endif %}
                </div>
                
                <div class="interest-section">
                    <div class="interest-label">
                        <i class="fas fa-chart-line"></i>
                        ANNUAL RETURN
                    </div>
                    <div class="interest-content">
                        <div class="interest-rate violet">40%</div>
                        <div class="price-range">One-time investment (any amount)</div>
                        <p style="margin-top: 15px; color: var(--text-medium); font-size: 0.85rem;">
                            Make a one-time lump sum investment today and receive 40% interest after 12 months. No monthly contributions required.
                        </p>
                    </div>
                </div>
                
                <div class="purchase-section">
                    <form method="POST" action="{% url 'enroll_plan' %}" class="purchase-form" data-thrift-id="{{ thrift.id }}" data-thrift-name="{{ thrift.thriftname|upper }} Plan" data-plan-type="max" data-interest-rate="40" data-price-range="one-time">
                        {% csrf_token %}
                        <input type="hidden" name="thrift_id" value="{{ thrift.id }}">
                        <input type="hidden" name="plan_type" value="max">
                        <input type="hidden" name="interest_rate" value="40">
                        <input type="hidden" name="price_range" value="one-time">
                        
                        <div class="binding-warning">
                            <i class="fas fa-gavel"></i>
                            <span>This is a legally binding investment. Once confirmed, the one-time payment is committed for the 12-month term.</span>
                        </div>
                        <button type="button" class="buy-now-btn">
                            <i class="fas fa-shopping-cart"></i>
                            Purchase Thrift
                        </button>
                    </form>
                </div>
            </div>
            {% endif %}

            <!-- Delete Confirmation Modal for each thrift item -->
            {% if user.is_staff or user.username == "manager" %}
            <div class="modal fade modal-custom" id="deleteModal{{ thrift.id }}" tabindex="-1" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content modal-content-custom">
                        <div class="modal-header modal-header-custom">
                            <h5 class="modal-title modal-title-custom">
                                <i class="fas fa-exclamation-triangle"></i>
                                Confirm Deletion
                            </h5>
                            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body modal-body-custom">
                            <p style="font-size: 0.95rem; margin-bottom: 20px;">
                                Are you sure you want to delete <strong>"{{ thrift.thriftname|upper }} Plan"</strong>?
                            </p>
                            <div style="background: rgba(220, 53, 69, 0.08); padding: 15px; border-radius: 10px; border-left: 4px solid var(--danger-red);">
                                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                                    <i class="fas fa-exclamation-triangle" style="color: var(--danger-red);"></i>
                                    <strong style="color: var(--danger-red);">Warning:</strong>
                                </div>
                                <p style="margin: 0; color: var(--text-medium); font-size: 0.85rem;">
                                    All enrollment records for this plan will also be permanently removed!
                                </p>
                            </div>
                        </div>
                        <div class="modal-footer modal-footer-custom">
                            <button type="button" class="btn-cancel" data-bs-dismiss="modal">
                                <i class="fas fa-times me-2"></i> Cancel
                            </button>
                            <form method="POST" action="{% url 'delete_thrift' thrift.id %}" style="margin: 0;">
                                {% csrf_token %}
                                <button type="submit" class="btn-delete">
                                    <i class="fas fa-trash me-2"></i> Delete Permanently
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            {% endif %}
        {% empty %}
        <div class="empty-state">
            <div class="empty-icon">
                <i class="fas fa-piggy-bank"></i>
            </div>
            <h3 class="empty-title">No Savings Plans Available</h3>
            <p class="empty-text">
                There are currently no savings plans available for enrollment. 
                Please check back soon or contact support for more information.
            </p>
            {% if user.is_staff or user.username == "manager" %}
            <a href="{% url 'create-thrift' %}" class="add-item-btn">
                <i class="fas fa-plus-circle"></i> Add Savings Plan
            </a>
            {% endif %}
        </div>
        {% endfor %}
    </div>
</div>
<!-- Purchase Confirmation Modal -->
<div class="modal fade modal-custom" id="confirmationModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content modal-content-custom">

            <!-- Modal Header -->
            <div class="modal-header modal-header-custom">
                <h5 class="modal-title modal-title-custom">
                    <i class="fas fa-gavel"></i>
                    Confirm Enrollment
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>

            <!-- Modal Body -->
            <div class="modal-body modal-body-custom">
                <p id="confirmationMessage" style="font-size: 0.95rem;">
                    You are about to enroll in the <strong id="planNameDisplay"></strong>.
                </p>

                <div id="purchaseDetails"
                     style="background: rgba(0, 119, 255, 0.03);
                            padding: 20px;
                            border-radius: 12px;
                            border: 1px solid rgba(0, 119, 255, 0.1);
                            font-size: 0.85rem;">
                </div>

                <!-- Binding Notice -->
                <div style="background: rgba(255, 193, 7, 0.15);
                            border: 1px solid #ffc107;
                            border-radius: 12px;
                            padding: 20px;
                            margin-top: 25px;">
                    <div style="display: flex; gap: 15px;">
                        <i class="fas fa-file-signature"
                           style="color: #ffc107; font-size: 1.3rem;"></i>
                        <div>
                            <h6 style="font-weight: 700;">Legally Binding Agreement</h6>
                            <p style="font-size: 0.8rem; margin: 0;">
                                By confirming this enrollment, you commit fully to the savings plan terms.
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Modal Footer -->
            <div class="modal-footer modal-footer-custom">

                <!-- ✅ FIXED Cancel Button -->
                <button type="button" class="btn-cancel" data-bs-dismiss="modal">
                    <i class="fas fa-times me-2"></i> Cancel
                </button>

                <!-- Confirm Button -->
                <button type="button" class="btn-confirm" id="confirmPurchaseBtn">
                    <i class="fas fa-check me-2"></i> I Agree & Confirm
                </button>

            </div>
        </div>
    </div>
</div>


<!-- Success Toast Container -->
<div class="toast-container position-fixed top-0 end-0 p-3" style="z-index: 9999;">
    <div id="successToast" class="toast toast-custom" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="toast-header toast-header-custom">
            <strong class="me-auto">
                <i class="fas fa-check-circle me-2"></i>
                Enrollment Successful!
            </strong>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
        <div class="toast-body toast-body-custom" id="toastMessage">
            You have successfully enrolled in the savings plan.
        </div>
    </div>
</div>
{% else %}
<div style="display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 60vh; text-align: center; padding: 20px;">
    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 50%; width: 80px; height: 80px; display: flex; align-items: center; justify-content: center; margin-bottom: 24px; box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);">
        <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
            <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
        </svg>
    </div>
    
    <h1 style="font-size: 1.8rem; color: #1a1a1a; margin-bottom: 16px; font-weight: 600; line-height: 1.3;">
        Account Activation Required
    </h1>
    
    <p style="font-size: 1.1rem; color: #666; max-width: 500px; margin-bottom: 28px; line-height: 1.6;">
        You need to activate your account to purchase thrifts. Please verify your email or contact support.
    </p>
    
    <a href="/" style="display: inline-flex; align-items: center; gap: 8px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 12px 32px; border-radius: 50px; text-decoration: none; font-weight: 500; font-size: 1rem; box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3); transition: all 0.3s ease;">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
            <polyline points="9 22 9 12 15 12 15 22"></polyline>
        </svg>
        Return to Home
    </a>
</div>

{% endif %}
<script>
document.addEventListener("DOMContentLoaded", function () {

    const modalElement = document.getElementById("confirmationModal");
    const confirmationModal = new bootstrap.Modal(modalElement);

    let currentForm = null;

    // ✅ Reset all Purchase buttons properly
    function resetButtons() {
        document.querySelectorAll(".buy-now-btn").forEach(btn => {
            btn.innerHTML = `<i class="fas fa-shopping-cart"></i> Purchase Thrift`;
            btn.disabled = false;
        });
    }

    // ✅ Handle Purchase Button Click
    document.querySelectorAll(".buy-now-btn").forEach(button => {

        button.addEventListener("click", function (e) {
            e.preventDefault();

            currentForm = this.closest("form");

            const thriftName = currentForm.dataset.thriftName;
            const planType = currentForm.dataset.planType;

            // Display plan name
            document.getElementById("planNameDisplay").textContent = thriftName;

            // Dynamic details
            let detailsHTML = "";

            if (planType === "basic") {
                detailsHTML = `<p><strong>Basic Plan:</strong> ₦25k–₦50k monthly (25% return)</p>`;
            }

            if (planType === "plus") {
                detailsHTML = `<p><strong>Plus Plan:</strong> ₦100k+ monthly (30% return)</p>`;
            }

            if (planType === "max") {
                detailsHTML = `<p><strong>Max Plan:</strong> One-time investment (40% return)</p>`;
            }

            document.getElementById("purchaseDetails").innerHTML = detailsHTML;

            // ✅ Show Modal
            confirmationModal.show();
        });

    });


    // ✅ Confirm Purchase Button
    document.getElementById("confirmPurchaseBtn").addEventListener("click", function () {

        if (!currentForm) return;

        const submitBtn = currentForm.querySelector(".buy-now-btn");

        // Loading state
        submitBtn.innerHTML =
            `<span class="spinner-border spinner-border-sm me-2"></span> Processing...`;
        submitBtn.disabled = true;

        // Submit normally
        currentForm.submit();
    });


    // ✅ FIXED Modal Cleanup (removes invisible backdrop bug)
    modalElement.addEventListener("hidden.bs.modal", function () {

        // Reset everything
        resetButtons();
        currentForm = null;

        // Remove stuck backdrops
        document.querySelectorAll(".modal-backdrop").forEach(el => el.remove());

        // Restore body scroll + click
        document.body.classList.remove("modal-open");
        document.body.style.overflow = "auto";
    });

});
</script>

{% endblock %}